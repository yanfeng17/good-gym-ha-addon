# Good-GYM Home Assistant Automation Examples
# å°†è¿™äº›è‡ªåŠ¨åŒ–æ·»åŠ åˆ°ä½ çš„ automations.yaml

# è‡ªåŠ¨åŒ– 1: è¾¾åˆ°ç›®æ ‡æ¬¡æ•°æ—¶å‘é€é€šçŸ¥
- id: good_gym_goal_reached
  alias: å¥èº«ç›®æ ‡è¾¾æˆé€šçŸ¥
  description: å®Œæˆé¢„è®¾æ¬¡æ•°çš„è¿åŠ¨æ—¶å‘é€é€šçŸ¥
  trigger:
    - platform: numeric_state
      entity_id: sensor.good_gym_squat_counter
      above: 30
  condition:
    # ç¡®ä¿ä»Šå¤©è¿˜æ²¡æœ‰å‘é€è¿‡é€šçŸ¥
    - condition: template
      value_template: >
        {{ as_timestamp(now()) - as_timestamp(state_attr('automation.good_gym_goal_reached', 'last_triggered')) > 3600 }}
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "ğŸ‰ å¥èº«ç›®æ ‡è¾¾æˆï¼"
        message: "æ­å–œï¼ä½ å®Œæˆäº† {{ states('sensor.good_gym_squat_counter') }} ä¸ªæ·±è¹²ï¼"
        data:
          push:
            sound: success
          actions:
            - action: "RESET_COUNTER"
              title: "é‡ç½®è®¡æ•°"

# è‡ªåŠ¨åŒ– 2: æ¯æ¬¡è®¡æ•°å¢åŠ æ—¶æ’­æ”¾æç¤ºéŸ³
- id: good_gym_count_beep
  alias: è¿åŠ¨è®¡æ•°æç¤ºéŸ³
  description: æ¯å®Œæˆä¸€æ¬¡è¿åŠ¨æ—¶æ’­æ”¾æç¤ºéŸ³
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
  condition:
    # åªåœ¨è®¡æ•°å¢åŠ æ—¶è§¦å‘
    - condition: template
      value_template: "{{ trigger.to_state.state | int > trigger.from_state.state | int }}"
  action:
    - service: media_player.play_media
      target:
        entity_id: media_player.living_room_speaker
      data:
        media_content_id: "media-source://media_source/local/sounds/beep.mp3"
        media_content_type: "music"

# è‡ªåŠ¨åŒ– 3: æ¯æ¬¡è¿åŠ¨æ—¶æ™ºèƒ½ç¯å…‰é—ªçƒ
- id: good_gym_light_flash
  alias: è¿åŠ¨è®¡æ•°ç¯å…‰åé¦ˆ
  description: å®ŒæˆåŠ¨ä½œæ—¶ç¯å…‰é—ªçƒç»¿è‰²
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state | int > trigger.from_state.state | int }}"
  action:
    - service: light.turn_on
      target:
        entity_id: light.living_room
      data:
        flash: short
        rgb_color: [0, 255, 0]

# è‡ªåŠ¨åŒ– 4: è¾¾åˆ°é‡Œç¨‹ç¢‘æ—¶è¯­éŸ³æ’­æŠ¥
- id: good_gym_milestone
  alias: è¿åŠ¨é‡Œç¨‹ç¢‘æ’­æŠ¥
  description: è¾¾åˆ° 10ã€20ã€30 ç­‰æ•´æ•°å€æ—¶è¯­éŸ³æ’­æŠ¥
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
  condition:
    - condition: template
      value_template: "{{ (trigger.to_state.state | int) % 10 == 0 and trigger.to_state.state | int > 0 }}"
  action:
    - service: tts.google_translate_say
      target:
        entity_id: media_player.living_room_speaker
      data:
        message: "å·²å®Œæˆ {{ states('sensor.good_gym_squat_counter') }} ä¸ªæ·±è¹²ï¼Œç»§ç»­åŠ æ²¹ï¼"
        language: "zh-CN"

# è‡ªåŠ¨åŒ– 5: æ¯æ—¥è¿åŠ¨æé†’
- id: good_gym_daily_reminder
  alias: æ¯æ—¥è¿åŠ¨æé†’
  description: æ¯å¤©æ™šä¸Š8ç‚¹æé†’å¥èº«
  trigger:
    - platform: time
      at: "20:00:00"
  condition:
    # åªåœ¨ä»Šå¤©è¿åŠ¨æ¬¡æ•°å°‘äºç›®æ ‡æ—¶æé†’
    - condition: numeric_state
      entity_id: sensor.good_gym_squat_counter
      below: 30
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "â° å¥èº«æé†’"
        message: "ä»Šå¤©è¿˜æ²¡å®Œæˆå¥èº«ç›®æ ‡å“¦ï¼å½“å‰è¿›åº¦: {{ states('sensor.good_gym_squat_counter') }} / 30"

# è‡ªåŠ¨åŒ– 6: è¿åŠ¨å¼€å§‹æ—¶è°ƒæ•´ç¯å…‰å’ŒéŸ³ä¹
- id: good_gym_workout_mode
  alias: è¿›å…¥å¥èº«æ¨¡å¼
  description: æ£€æµ‹åˆ°è¿åŠ¨å¼€å§‹æ—¶è‡ªåŠ¨è°ƒæ•´ç¯å¢ƒ
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
      attribute: stage
      to: "up"
  condition:
    # ç¡®ä¿æ˜¯æ–°çš„è¿åŠ¨ä¼šè¯ï¼ˆè·ç¦»ä¸Šæ¬¡æ›´æ–°è¶…è¿‡5åˆ†é’Ÿï¼‰
    - condition: template
      value_template: >
        {{ as_timestamp(now()) - as_timestamp(states.sensor.good_gym_squat_counter.last_changed) > 300 }}
  action:
    # è°ƒæ•´ç¯å…‰ä¸ºè¿åŠ¨æ¨¡å¼
    - service: light.turn_on
      target:
        entity_id: light.living_room
      data:
        brightness: 255
        color_temp: 250
    # æ’­æ”¾å¥èº«éŸ³ä¹
    - service: media_player.play_media
      target:
        entity_id: media_player.spotify
      data:
        media_content_id: "spotify:playlist:37i9dQZF1DX76Wlfdnj7AP"
        media_content_type: "playlist"

# è‡ªåŠ¨åŒ– 7: æ¯æ—¥ç»Ÿè®¡æŠ¥å‘Š
- id: good_gym_daily_report
  alias: æ¯æ—¥è¿åŠ¨ç»Ÿè®¡æŠ¥å‘Š
  description: æ¯å¤©æ™šä¸Š10ç‚¹å‘é€è¿åŠ¨ç»Ÿè®¡
  trigger:
    - platform: time
      at: "22:00:00"
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "ğŸ“Š ä»Šæ—¥è¿åŠ¨æŠ¥å‘Š"
        message: |
          ä»Šæ—¥å®Œæˆ {{ states('sensor.good_gym_squat_counter') }} ä¸ªæ·±è¹²
          {% if states('sensor.good_gym_squat_counter') | int >= 30 %}
          ğŸ‰ æ­å–œè¾¾æˆç›®æ ‡ï¼
          {% else %}
          ğŸ’ª æ˜å¤©ç»§ç»­åŠ æ²¹ï¼
          {% endif %}

# è‡ªåŠ¨åŒ– 8: æ¸¸æˆåŒ– - è¿å‡»ç³»ç»Ÿ
- id: good_gym_combo_system
  alias: è¿åŠ¨è¿å‡»æ•ˆæœ
  description: è¿ç»­å¿«é€Ÿå®ŒæˆåŠ¨ä½œæ—¶ç»™äºˆé¢å¤–åé¦ˆ
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
  variables:
    time_since_last: "{{ as_timestamp(now()) - as_timestamp(trigger.from_state.last_changed) }}"
  condition:
    # åœ¨3ç§’å†…å®ŒæˆåŠ¨ä½œè§†ä¸ºè¿å‡»
    - condition: template
      value_template: "{{ time_since_last < 3 }}"
    - condition: template
      value_template: "{{ trigger.to_state.state | int > trigger.from_state.state | int }}"
  action:
    - service: light.turn_on
      target:
        entity_id: light.living_room
      data:
        effect: "colorloop"
    - delay: "00:00:02"
    - service: light.turn_on
      target:
        entity_id: light.living_room
      data:
        effect: "none"

# è‡ªåŠ¨åŒ– 9: è®°å½•ä¸ªäººæœ€ä½³æˆç»©
- id: good_gym_personal_best
  alias: ä¸ªäººæœ€ä½³è®°å½•
  description: æ‰“ç ´ä¸ªäººè®°å½•æ—¶å‘é€ç‰¹æ®Šé€šçŸ¥
  trigger:
    - platform: state
      entity_id: sensor.good_gym_squat_counter
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state | int > states('input_number.squat_personal_best') | int }}"
  action:
    # æ›´æ–°ä¸ªäººæœ€ä½³è®°å½•
    - service: input_number.set_value
      target:
        entity_id: input_number.squat_personal_best
      data:
        value: "{{ trigger.to_state.state | int }}"
    # å‘é€åº†ç¥é€šçŸ¥
    - service: notify.mobile_app_your_phone
      data:
        title: "ğŸ† æ–°è®°å½•ï¼"
        message: "æ­å–œï¼ä½ æ‰“ç ´äº†ä¸ªäººæœ€ä½³è®°å½•ï¼Œå®Œæˆäº† {{ trigger.to_state.state }} ä¸ªæ·±è¹²ï¼"
        data:
          push:
            sound: success
            badge: 1

# è‡ªåŠ¨åŒ– 10: ä¼‘æ¯æé†’
- id: good_gym_rest_reminder
  alias: è¿åŠ¨ä¼‘æ¯æé†’
  description: è¿ç»­è¿åŠ¨ä¸€å®šæ—¶é—´åæé†’ä¼‘æ¯
  trigger:
    - platform: numeric_state
      entity_id: sensor.good_gym_squat_counter
      above: 20
  condition:
    # æ£€æŸ¥æœ€è¿‘10åˆ†é’Ÿå†…æ˜¯å¦æŒç»­è¿åŠ¨
    - condition: template
      value_template: >
        {{ as_timestamp(now()) - as_timestamp(states.sensor.good_gym_squat_counter.last_changed) < 600 }}
  action:
    - service: notify.mobile_app_your_phone
      data:
        title: "ğŸ’§ ä¼‘æ¯æé†’"
        message: "ä½ å·²ç»å®Œæˆäº† {{ states('sensor.good_gym_squat_counter') }} ä¸ªæ·±è¹²ï¼Œæ³¨æ„ä¼‘æ¯å’Œè¡¥æ°´å“¦ï¼"
